{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx","path":"/analysingyourfacebookmessengerchat","webpackCompilationHash":"b0fa62b974cfe2a11d01","result":{"data":{"post":{"headings":[{"depth":3},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Analysing Your Facebook Messenger Chat","path":"/analysingyourfacebookmessengerchat","tags":["Data Visualization","Python","Programming","GitHub","Facebook"],"excerpt":"Facebook always provided an archive of your data which it stores. It came into light when the Cambridge Analytica data breach event happened. Read this blog to know how I made use of Facebook data to analyse your Facebook Messenger chat.","created":"2019-05-08T00:00:00.000Z","createdPretty":"08 May, 2019","updated":"2019-05-08T00:00:00.000Z","updatedPretty":"08 May, 2019","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAwT/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAHjwpydIYUR/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAIBAxARITT/2gAIAQEAAQUChM0TQ3Db/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhABAQEAAAAAAAAAAAAAAAAAARAC/9oACAEBAAY/AnQUv//EAB8QAQABAQkAAAAAAAAAAAAAAAEAERAhMUFRYXGBsf/aAAgBAQABPyHLQZwAOFWGqvTLtPb23//aAAwDAQACAAMAAAAQ1z//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAQQBBQAAAAAAAAAAAAABEQAhMUEQUWFxofD/2gAIAQEAAT8QgvGdcABq/wBNIOPGU2ND5qAtk9s9jRMNN8buqXrx/9k=","aspectRatio":1.99800796812749,"src":"/blog/static/3bea2ec5455af0240c0d1b4a685d3dd0/57238/cover.jpg","srcSet":"/blog/static/3bea2ec5455af0240c0d1b4a685d3dd0/5398f/cover.jpg 200w,\n/blog/static/3bea2ec5455af0240c0d1b4a685d3dd0/26a4d/cover.jpg 400w,\n/blog/static/3bea2ec5455af0240c0d1b4a685d3dd0/57238/cover.jpg 800w,\n/blog/static/3bea2ec5455af0240c0d1b4a685d3dd0/a1e84/cover.jpg 1003w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h3 id=\"an-insight-to-a-part-of-your-data-that-facebook-has\"><a href=\"#an-insight-to-a-part-of-your-data-that-facebook-has\" aria-label=\"an insight to a part of your data that facebook has permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>An insight to a part of your data that Facebook has</h3>\n<p>Facebook always provided an archive of your data which it stores. It came into light when the Cambridge Analytica data breach event happened. In my opinion I feel that Google stores more user data than Facebook for a user. I found that all my searches not on Google but even on external sites such as GitHub were stored by Google. Although this data can be deleted but still this data is there and just with a combination of username and password can be accessed by anyone.</p>\n<h2 id=\"the-idea\"><a href=\"#the-idea\" aria-label=\"the idea permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>The Idea</strong></h2>\n<p>I was fascinated by Data Visualisations and wanted a start. So months before the Cambridge Analytica event happened, it came into my mind to plot a graph of my chat with my Facebook friend. So the idea was to plot the total number of messages sent or received in a day. I usually code in python and knew about one plotting library <code class=\"language-text\">matplotlib</code>.</p>\n<h2 id=\"getting-started-collecting-chat-data\"><a href=\"#getting-started-collecting-chat-data\" aria-label=\"getting started collecting chat data permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting Started: Collecting chat data</h2>\n<p>So finally after deciding what to do and what technologies to use, the main task was to get all the messages from a chat. One thought was to scrape the complete chat but scraping wouldn’t have been efficient and in the case where number of messages were in thousands, it would have taken hours to scrape a single chat. Also, this could have imposed a temporary ban on my IP address as scraping is something no website supports. I already had an experience of temporary ban from Reddit while learning web scraping, and I didn’t want to do that again.</p>\n<p>Then I remembered that Facebook provides an archive of user data, I tried giving it a shot. Luckily, when I extracted that zip, I found an html page for messages which had all my chat listed with each person and group till the time of data request. Each name was an html page with complete chat with that user. The code of each html was minified so it had to be unminified to analyse what was written there. On unminifying the html, it was clear that the code inside each html file of the chat was in a generic format with each message inside a div with class ‘message’. The message div has sender’s name, message time stamp and the message with each enclosed in an individual span tag. Sender’s name is in a span with class user, timestamp in a span with class meta and the message content in a paragraph ‘p’ tag.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2996/1*6330r-2IgwXeTLwwU1qzoA.png\" alt=\"Block of code containing required data in chat.html\"></p>\n<p><em><center>Block of code containing required data in chat.html</center></em></p>\n<h2 id=\"step-1-extracting-message-dates\"><a href=\"#step-1-extracting-message-dates\" aria-label=\"step 1 extracting message dates permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 1: Extracting message dates</h2>\n<p>Now I had the complete chat with me in an html format which just needed to be scraped to get the data. I used beautiful soup to get the timestamp of each message and dumped that data in a csv file “chatdata.csv”. This process takes 4–5 seconds only for the case when there are a lot of messages else it is almost instant. Up to this point, the csv is in a pretty bad condition with redundant values i.e multiple rows for the same timestamp.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2188/1*kHqvLfS1x_gd5KPhP82G7Q.png\" alt=\"Extracting and exporting message dates.\"></p>\n<p><em><center>Extracting and exporting message dates.</center></em></p>\n<h2 id=\"step-2-counting-messages-on-a-given-date\"><a href=\"#step-2-counting-messages-on-a-given-date\" aria-label=\"step 2 counting messages on a given date permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 2: Counting messages on a given date</h2>\n<p>The next task was to count the number of messages sent on a single day. I used pandas library to do it. The dataframe was the complete csv. I used groupby function to group the rows according to a particular date. After this step, I had all the dates on which the message was sent and the count of messages sent on that day exported to “count.csv”. The only step remaining was to sort the dates in ascending order so that graph is plotted in an ordered manner.</p>\n<h2 id=\"step-3-sorting-the-data\"><a href=\"#step-3-sorting-the-data\" aria-label=\"step 3 sorting the data permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3: Sorting the data</h2>\n<p>By using <code class=\"language-text\">sort_values</code> function in pandas library I sorted the count.csv from the previous step in ascending order of dates. The timestamp originally contains date and time in the format <code class=\"language-text\">Sunday,April 8,2018 at 12:02pm UTC+5:30</code>. So while creating the “chatdata.csv” I extracted only the date from the timestamp and while creating the final sorted.csv the date is converted to YYYY-MM-DD format using <code class=\"language-text\">to_date</code> function in pandas library. The “sorted.csv” is the data file which has the count of messages on a given day in ascending order of dates. The final task remaining is to plot these two columns on a graph.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2556/1*EhMaLAZga6HnXy2og8_vHg.png\" alt=\"Counting and sorting the message dates\"></p>\n<p><em><center>Counting and sorting the message dates</center></em></p>\n<h2 id=\"final-step-plotting-graph-and-running-the-script\"><a href=\"#final-step-plotting-graph-and-running-the-script\" aria-label=\"final step plotting graph and running the script permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Final Step: Plotting graph and running the script.</h2>\n<p>To plot the data, I used matlplotlib library. I kept dates on x-axis and the count of messages on that day on y-axis.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/3532/1*CsADwM25yamM2nIrE3MDuw.png\" alt=\"main function to create dataset and plot the graph\"></p>\n<p><em><center>main function to create dataset and plot the graph</center></em></p>\n<p>Now it was time to give python script a test run and Voila! the output was there on the screen. It was fun to test the script on different chats and comparing the graph among them.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2000/1*Rg89_ZgkgemZdwO656a2nA.png\" alt=\"Sample output plot\"></p>\n<p><em><center>Sample output plot</center></em></p>\n<h2 id=\"final-words\"><a href=\"#final-words\" aria-label=\"final words permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Final Words</h2>\n<p>The source code for the complete script can be found <a href=\"https://github.com/Anupam-dagar/Data-Visualisation-Facebook-Chat\">here at GitHub</a>.</p>\n<p>The code was written in a small time and hence has bad variable naming and creation of 3 files. I believe number of files generated can be reduced to 1 or 2 and the complete code can be made more better by incorporating more features. Also the x-axis containing dates gets cluttered because of less space and big length of date which needs to be corrected. The script currently plots count for only the days when message was sent or recieved, there is no point for any day when no message was sent or received i.e 0 messages in a day, the plot will be more better if those days are also accomodated. Any contributions to code are welcome.</p>"},"primaryTag":{"name":"Data Visualization","color":"#007acc"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"postId":"1e29badc-969b-5f42-a9c6-abb27e3bdbae","primaryTag":"Data Visualization"}}}